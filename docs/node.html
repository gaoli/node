<!DOCTYPE html>

<html>
<head>
  <title>node.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>node.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>;(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(global, S)</span> {</span>

<span class="hljs-comment">/**
 * @ignore
 * @file util
 * @author 莫争 &lt;gaoli.gl@taobao.com&gt;
 */</span>

<span class="hljs-keyword">var</span> win   = window,
    doc   = document,
    body  = doc.body,
    docEl = doc.documentElement;

<span class="hljs-keyword">var</span> emptyArray = [],
    some       = emptyArray.some,
    every      = emptyArray.every,
    slice      = emptyArray.slice,
    filter     = emptyArray.filter,
    concat     = emptyArray.concat,
    indexOf    = emptyArray.indexOf,
    forEach    = emptyArray.forEach;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mix</span><span class="hljs-params">(target, source)</span> {</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> source) {
        target[key] = source[key];
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">map</span><span class="hljs-params">(els, cb)</span> {</span>
    <span class="hljs-keyword">var</span> val,
        ret = [];

    els &amp;&amp; forEach.call(els, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el, index)</span> {</span>
        val = cb(el, index);
        <span class="hljs-keyword">if</span> (val !== <span class="hljs-literal">null</span>) {
            ret.push(val);
        }
    });

    <span class="hljs-keyword">return</span> ret.length ? concat.apply([], ret) : ret;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">each</span><span class="hljs-params">(els, callback)</span> {</span>
    els &amp;&amp; forEach.call(els, callback);
    <span class="hljs-keyword">return</span> els;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isWindow</span><span class="hljs-params">(node)</span> {</span>
    <span class="hljs-keyword">return</span> node &amp;&amp; node == node.window;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isDocument</span><span class="hljs-params">(node)</span> {</span>
    <span class="hljs-keyword">return</span> node &amp;&amp; node.nodeType === <span class="hljs-number">9</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isElement</span><span class="hljs-params">(node)</span> {</span>
    <span class="hljs-keyword">return</span> node &amp;&amp; node.nodeType === <span class="hljs-number">1</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">likeArray</span><span class="hljs-params">(nodes)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> nodes.length == <span class="hljs-string">'number'</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unique</span><span class="hljs-params">(array)</span> {</span>
    <span class="hljs-keyword">return</span> filter.call(array, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(item, index)</span> {</span>
        <span class="hljs-keyword">return</span> array.indexOf(item) == index;
    });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getScript</span><span class="hljs-params">(url)</span> {</span>
    <span class="hljs-keyword">var</span> script = doc.createElement(<span class="hljs-string">'script'</span>),
        head   = doc.getElementsByTagName(<span class="hljs-string">'head'</span>)[<span class="hljs-number">0</span>] || docEl;

    script.src = url;
    head.insertBefore(script, head.firstChild);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isType</span><span class="hljs-params">(type)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span> {</span>
        <span class="hljs-keyword">return</span> {}.toString.call(obj) == <span class="hljs-string">'[object '</span> + type + <span class="hljs-string">']'</span>;
    }
}

<span class="hljs-keyword">var</span> isNumber   = isType(<span class="hljs-string">'Number'</span>),
    isString   = isType(<span class="hljs-string">'String'</span>),
    isObject   = isType(<span class="hljs-string">'Object'</span>),
    isArray    = <span class="hljs-built_in">Array</span>.isArray || isType(<span class="hljs-string">'Array'</span>),
    isFunction = isType(<span class="hljs-string">'Function'</span>);

<span class="hljs-keyword">var</span> isPlainObject = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span> {</span>
    <span class="hljs-keyword">return</span> isObject(obj) &amp;&amp; !isWindow(obj) &amp;&amp; <span class="hljs-built_in">Object</span>.getPrototypeOf(obj) == <span class="hljs-built_in">Object</span>.prototype;
};
<span class="hljs-comment">/**
 * @ignore
 * @file node
 * @author 莫争 &lt;gaoli.gl@taobao.com&gt;
 */</span>

<span class="hljs-keyword">var</span> node = {};

mix(node, {

    indexOf: indexOf,

    each: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(cb)</span> {</span>
        every.call(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el, index)</span> {</span>
            el = $(el);
            <span class="hljs-keyword">return</span> cb.call(el, el, index) !== <span class="hljs-literal">false</span>;
        });
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    },

    slice: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> $(slice.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>));
    },

    end: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.__parent || <span class="hljs-keyword">this</span>;
    }

});

<span class="hljs-keyword">var</span> $ = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selector, context)</span> {</span>
    <span class="hljs-keyword">var</span> ret = [];

    <span class="hljs-keyword">if</span> (selector) {
        <span class="hljs-keyword">if</span> (isString(selector)) {
            selector = selector.trim();

            <span class="hljs-keyword">if</span> (selector[<span class="hljs-number">0</span>] == <span class="hljs-string">'&lt;'</span> &amp;&amp; <span class="hljs-regexp">/&lt;([\w:]+)/</span>.test(selector)) {
                ret = node.create(selector);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (context !== <span class="hljs-literal">undefined</span>) {
                ret = find(selector, $(context));
            } <span class="hljs-keyword">else</span> {
                ret = query(selector, doc);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (selector.nodeType || selector.setTimeout) {
                ret = [selector];
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isArray(selector)) {
                ret = selector;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!selector.nodeType &amp;&amp; !selector.setTimeout &amp;&amp; selector.item) {
                ret = slice.call(selector);
            }
        }
    }

    <span class="hljs-keyword">return</span> $.node(ret);
};

$.all = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selector, context)</span> {</span>
    <span class="hljs-keyword">return</span> $(selector, context);
};

$.one = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selector, context)</span> {</span>
    <span class="hljs-keyword">return</span> $(selector, context).item(<span class="hljs-number">0</span>);
};

$.node = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(els)</span> {</span>
    els = els || [];
    els.__proto__ = S.node;
    <span class="hljs-keyword">return</span> els;
};

$.isNode = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span> {</span>
    <span class="hljs-keyword">return</span> obj <span class="hljs-keyword">instanceof</span> $.node;
};
<span class="hljs-comment">/**
 * @ignore
 * @file node-selector
 * @author 莫争 &lt;gaoli.gl@taobao.com&gt;
 */</span>

<span class="hljs-keyword">var</span> tempParent = document.createElement(<span class="hljs-string">'div'</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">find</span><span class="hljs-params">(selector, context)</span> {</span>
    <span class="hljs-keyword">return</span> context.length === <span class="hljs-number">1</span> ?
        query(selector, context[<span class="hljs-number">0</span>]) :
        unique(
            map(context, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                <span class="hljs-keyword">return</span> query(selector, el);
            })
        );
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">query</span><span class="hljs-params">(selector, context)</span> {</span>
    <span class="hljs-keyword">var</span> s        = selector.charAt(<span class="hljs-number">0</span>), ret,
        maybeID  = s === <span class="hljs-string">'#'</span>,
        maybeCls = s === <span class="hljs-string">'.'</span>,
        nameOnly = maybeID || maybeCls ? selector.slice(<span class="hljs-number">1</span>) : selector,
        isSimple = <span class="hljs-regexp">/^[\w-]*$/</span>.test(nameOnly);

    <span class="hljs-keyword">return</span> isDocument(context) || isElement(context) ?
        isDocument(context) &amp;&amp; maybeID &amp;&amp; isSimple ?
            (ret = context.getElementById(nameOnly)) ? [ret] : [] :
            slice.call(
                !maybeID &amp;&amp; isSimple ?
                    maybeCls ?
                        context.getElementsByClassName(nameOnly) :
                        context.getElementsByTagName(selector) :
                    context.querySelectorAll(selector)
            )
        : [];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">matches</span><span class="hljs-params">(el, selector)</span> {</span>
    <span class="hljs-keyword">if</span> (!el || !selector || !isElement(el)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">var</span> matchesSelector = el.webkitMatchesSelector ||
                          el.mozMatchesSelector ||
                          el.oMatchesSelector ||
                          el.matchesSelector;

    <span class="hljs-keyword">if</span> (matchesSelector) {
        <span class="hljs-keyword">return</span> matchesSelector.call(el, selector);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> parent    = el.parentNode,
            hasParent = !!parent,
            match;

        <span class="hljs-keyword">if</span> (!hasParent) {
            parent = tempParent;
            parent.appendChild(el);
        }

        match = ~query(selector, parent).indexOf(el);
        !hasParent &amp;&amp; parent.removeChild(el);

        <span class="hljs-keyword">return</span> match;
    }
}

mix(S, {
    query: query
});

mix(node, {

    all: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selector)</span> {</span>
        <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
            ret;

        ret = $(find(selector, self));
        ret.__parent = self;

        <span class="hljs-keyword">return</span> ret;
    },

    one: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selector)</span> {</span>
        <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
            ret;

        ret = self.all(selector);
        ret = ret.length ? ret.slice(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>) : <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">if</span> (ret) {
            ret.__parent = self;
        }

        <span class="hljs-keyword">return</span> ret;
    },

    filter: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selector)</span> {</span>
        <span class="hljs-keyword">if</span> (isFunction(selector)) {
            <span class="hljs-keyword">return</span> $(filter.call(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                <span class="hljs-keyword">return</span> selector.call(el, el);
            }));
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> $(filter.call(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                <span class="hljs-keyword">return</span> matches(el, selector);
            }));
        }
    }

});

<span class="hljs-comment">/**
 * @ignore
 * @file node-class
 * @author 莫争 &lt;gaoli.gl@taobao.com&gt;
 */</span>

<span class="hljs-keyword">var</span> classCache = {};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">classRE</span><span class="hljs-params">(name)</span> {</span>
    <span class="hljs-keyword">return</span> name <span class="hljs-keyword">in</span> classCache ?
        classCache[name] : (classCache[name] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">'(^|\\s)'</span> + name + <span class="hljs-string">'(\\s|$)'</span>));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">className</span><span class="hljs-params">(el, val)</span> {</span>
    <span class="hljs-keyword">if</span> (val === <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">return</span> el.className;
    } <span class="hljs-keyword">else</span> {
        el.className = val;
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">classSplit</span><span class="hljs-params">(names)</span> {</span>
    <span class="hljs-keyword">return</span> names.split(<span class="hljs-regexp">/[\.\s]\s*\.?/</span>);
}

mix(node, {

    addClass: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(names)</span> {</span>
        <span class="hljs-keyword">if</span> (!names) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">return</span> each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            <span class="hljs-keyword">var</span> $el       = $(el),
                cls       = className(el),
                classList = [];

            each(classSplit(names), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> {</span>
                !$el.hasClass(name) &amp;&amp; classList.push(name)
            });

            classList.length &amp;&amp; className(el, cls + (cls ? <span class="hljs-string">' '</span> : <span class="hljs-string">''</span>) + classList.join(<span class="hljs-string">' '</span>))
        });
    },

    removeClass: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(names)</span> {</span>
        <span class="hljs-keyword">return</span> each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            <span class="hljs-keyword">if</span> (names === <span class="hljs-literal">undefined</span>) {
                <span class="hljs-keyword">return</span> className(el, <span class="hljs-string">''</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">var</span> classList = className(el);

                each(classSplit(names), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> {</span>
                    classList = classList.replace(classRE(name), <span class="hljs-string">' '</span>);
                });

                className(el, classList.trim());
            }
        });
    },

    toggleClass: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(names)</span> {</span>
        <span class="hljs-keyword">if</span> (!names) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">return</span> each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            <span class="hljs-keyword">var</span> $el = $(el);

            each(classSplit(names), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> {</span>
                $el.hasClass(name) ? $el.removeClass(name) : $el.addClass(name)
            });
        });
    },

    hasClass: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(names)</span> {</span>
        <span class="hljs-keyword">if</span> (!names) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">return</span> some.call(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            <span class="hljs-keyword">return</span> every.call(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> {</span>
                <span class="hljs-keyword">return</span> name ? classRE(name).test(className(el)) : <span class="hljs-literal">true</span>;
            });
        }, classSplit(names));
    }

});

<span class="hljs-comment">/**
 * @ignore
 * @file node-attr
 * @author 莫争 &lt;gaoli.gl@taobao.com&gt;
 */</span>

<span class="hljs-keyword">var</span> RE_BOOLEAN = <span class="hljs-regexp">/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i</span>;

<span class="hljs-keyword">var</span> attrMethod = [<span class="hljs-string">'val'</span>, <span class="hljs-string">'css'</span>, <span class="hljs-string">'html'</span>, <span class="hljs-string">'text'</span>, <span class="hljs-string">'data'</span>, <span class="hljs-string">'width'</span>, <span class="hljs-string">'height'</span>, <span class="hljs-string">'offset'</span>],
    propFixMap = {
        hidefocus      : <span class="hljs-string">'hideFocus'</span>,
        tabindex       : <span class="hljs-string">'tabIndex'</span>,
        readonly       : <span class="hljs-string">'readOnly'</span>,
        <span class="hljs-string">'for'</span>          : <span class="hljs-string">'htmlFor'</span>,
        <span class="hljs-string">'class'</span>        : <span class="hljs-string">'className'</span>,
        maxlength      : <span class="hljs-string">'maxLength'</span>,
        cellspacing    : <span class="hljs-string">'cellSpacing'</span>,
        cellpadding    : <span class="hljs-string">'cellPadding'</span>,
        rowspan        : <span class="hljs-string">'rowSpan'</span>,
        colspan        : <span class="hljs-string">'colSpan'</span>,
        usemap         : <span class="hljs-string">'useMap'</span>,
        frameborder    : <span class="hljs-string">'frameBorder'</span>,
        contenteditable: <span class="hljs-string">'contentEditable'</span>
    };

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pluck</span><span class="hljs-params">(els, property)</span> {</span>
    <span class="hljs-keyword">return</span> map(els, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
        <span class="hljs-keyword">return</span> el[property];
    });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setAttribute</span><span class="hljs-params">(el, name, val)</span> {</span>
    val == <span class="hljs-literal">null</span> ? el.removeAttribute(name) : el.setAttribute(name, val)
}

mix(node, {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p><strong> .attr() </strong></p>
<ul>
<li><p>.attr(name)</p>
<p>获取符合选择器的第一个元素的属性值</p>
</li>
<li><p>.attr(name, val)</p>
<p>给符合选择器的所有元素设置属性值</p>
</li>
<li><p>.attr(kv)</p>
<p>给符合选择器的所有元素设置属性值</p>
</li>
</ul>
<p><code>.attr()</code> 和 <code>.prop()</code> 的区别</p>
<pre><code>el.attr(<span class="hljs-string">'checked'</span>) <span class="hljs-comment">// =&gt; "checked"</span>
el.prop(<span class="hljs-string">'checked'</span>) <span class="hljs-comment">// =&gt; true</span>
</code></pre><p><code>.attr()</code> 和 <code>.prop()</code> 的使用</p>
<p>从中文意思看，两者分别是获取 / 设置 attributes 和 properties 的方法，分别在这两个场景中使用：具有 true 和 false 两个属性的属性，如 checked，selected 或者 disabled 使用 <code>.prop()</code>，其他的使用 <code>.attr()</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    attr: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, val)</span> {</span>
        <span class="hljs-keyword">var</span> key,
            ret;

        <span class="hljs-keyword">if</span> (isPlainObject(name)) {
            <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> name) {
                node.attr.call(<span class="hljs-keyword">this</span>, key, name[key]);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

        <span class="hljs-keyword">if</span> (~attrMethod.indexOf(name)) {
            <span class="hljs-keyword">return</span> $(<span class="hljs-keyword">this</span>)[name](val);
        }

        <span class="hljs-keyword">if</span> (val == <span class="hljs-literal">undefined</span>) {
            <span class="hljs-keyword">var</span> el = <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>];

            <span class="hljs-keyword">if</span> (el &amp;&amp; isElement(el)) {
                <span class="hljs-keyword">if</span> (RE_BOOLEAN.test(name)) {
                    ret = $(el).prop(name) ? name.toLowerCase() : <span class="hljs-literal">undefined</span>;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name == <span class="hljs-string">'value'</span> &amp;&amp; el.nodeName == <span class="hljs-string">'INPUT'</span>) {
                    ret = <span class="hljs-keyword">this</span>.val();
                } <span class="hljs-keyword">else</span> {
                    ret = el.getAttribute(name);
                    ret = !ret &amp;&amp; name <span class="hljs-keyword">in</span> el ? el[name] : ret;
                }
            }
        } <span class="hljs-keyword">else</span> {
            ret = each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                isElement(el) &amp;&amp; setAttribute(el, name, val);
            });
        }

        <span class="hljs-keyword">return</span> ret === <span class="hljs-literal">null</span> ? <span class="hljs-literal">undefined</span> : ret;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p><strong> .removeAttr() </strong></p>
<ul>
<li><p>.removeAttr(name)</p>
<p>移除符合选择器的所有元素的指定属性</p>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeAttr: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> {</span>
        <span class="hljs-keyword">return</span> each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            isElement(el) &amp;&amp; setAttribute(el, name)
        });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p><strong> .hasAttr() </strong></p>
<ul>
<li><p>.hasAttr(name)</p>
<p>判断符合选择器的所有元素中是否有某个元素含有特定属性</p>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    hasAttr: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> {</span>
        <span class="hljs-keyword">if</span> (!name) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">return</span> some.call(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            <span class="hljs-keyword">return</span> isElement(el) &amp;&amp; el.getAttribute(name);
        });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p><strong> .prop() </strong></p>
<ul>
<li><p>.prop(name)</p>
<p>获取符合选择器的第一个元素的对应 property 值</p>
</li>
<li><p>.prop(name, val)</p>
<p>给符合选择器的所有元素设置 property 值</p>
</li>
<li><p>.prop(kv)</p>
<p>给符合选择器的所有元素设置 property 值</p>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    prop: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, val)</span> {</span>
        name = propFixMap[name] || name;
        <span class="hljs-keyword">return</span> val == <span class="hljs-literal">undefined</span> ?
            <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>] &amp;&amp; <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>][name] :
            each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                el[name] = val;
            });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p><strong> .hasProp() </strong></p>
<ul>
<li><p>.hasProp(name)</p>
<p>判断符合选择器的第一个元素是否含有特定 property 属性</p>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    hasProp: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name)</span> {</span>
        <span class="hljs-keyword">if</span> (!name) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        name = propFixMap[name] || name;
        <span class="hljs-keyword">return</span> some.call(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            <span class="hljs-keyword">return</span> isElement(el) &amp;&amp; el[name];
        });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p><strong> .val() </strong></p>
<ul>
<li><p>.val()</p>
<p>获取符合选择器的第一个元素所的 value 值</p>
</li>
<li><p>.val(val)</p>
<p>给符合选择器的所有元素设置 value 值</p>
</li>
</ul>
<p>如果是 <code>&lt;select multiple&gt;</code> 标签，则返回一个数组</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    val: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(val)</span> {</span>
        <span class="hljs-keyword">var</span> el = <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>];

        <span class="hljs-keyword">if</span> (!el) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;

        <span class="hljs-keyword">if</span> (el.multiple) {
            <span class="hljs-keyword">var</span> opts = $(<span class="hljs-string">'option'</span>, el);

            <span class="hljs-keyword">return</span> val == <span class="hljs-literal">undefined</span> ?
                slice.call(
                    pluck(
                        opts.filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(opt)</span> {</span>
                            <span class="hljs-keyword">return</span> opt.selected;
                        }), <span class="hljs-string">'value'</span>
                    )
                ) :
                each(opts, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(opt)</span> {</span>
                    opt.selected = ~val.indexOf(opt.value);
                });
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> val == <span class="hljs-literal">undefined</span> ?
                el.value :
                each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                    el.value = val;
                });
        }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong> .text() </strong></p>
<ul>
<li><p>.text()</p>
<p>获取符合选择器的第一个元素所包含的文本值</p>
</li>
<li><p>.val(text)</p>
<p>给符合选择器的所有元素设置文本值</p>
</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    text: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(text)</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>.length ?
            each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                el.textContent = (text === <span class="hljs-literal">undefined</span>) ? <span class="hljs-string">''</span> : <span class="hljs-string">''</span> + text
            }) :
            <span class="hljs-keyword">this</span>.length ? <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>].textContent : <span class="hljs-literal">null</span>;
    }

});

<span class="hljs-comment">/**
 * @ignore
 * @file node-style
 * @author 莫争 &lt;gaoli.gl@taobao.com&gt;
 */</span>

<span class="hljs-keyword">var</span> cssNumber = {
        columnCount: <span class="hljs-number">1</span>,
        columns    : <span class="hljs-number">1</span>,
        fontWeight : <span class="hljs-number">1</span>,
        lineHeight : <span class="hljs-number">1</span>,
        opacity    : <span class="hljs-number">1</span>,
        zIndex     : <span class="hljs-number">1</span>,
        zoom       : <span class="hljs-number">1</span>
    },
    elDisplay = {};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">camelCase</span><span class="hljs-params">(name)</span> {</span>
    <span class="hljs-keyword">return</span> name.replace(<span class="hljs-regexp">/-+(.)?/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>].toUpperCase();
    });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">maybeAddPx</span><span class="hljs-params">(name, val)</span> {</span>
    <span class="hljs-keyword">return</span> isNumber(val) &amp;&amp; !cssNumber[camelCase(name)] ? val + <span class="hljs-string">'px'</span> : val;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getComputedStyle</span><span class="hljs-params">(el, name)</span> {</span>
    <span class="hljs-keyword">return</span> win.getComputedStyle(el, <span class="hljs-literal">null</span>).getPropertyValue(name);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDefaultDisplay</span><span class="hljs-params">(tagName)</span> {</span>
    <span class="hljs-keyword">if</span> (!elDisplay[tagName]) {
        <span class="hljs-keyword">var</span> el = doc.createElement(tagName),
            display;

        body.appendChild(el);
        display = getComputedStyle(el, <span class="hljs-string">'display'</span>);
        el.parentNode.removeChild(el);
        display == <span class="hljs-string">'none'</span> &amp;&amp; (display = <span class="hljs-string">'block'</span>);
        elDisplay[tagName] = display;
    }

    <span class="hljs-keyword">return</span> elDisplay[tagName];
}

mix(node, {

    css: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, val)</span> {</span>
        <span class="hljs-keyword">var</span> key,
            ret = <span class="hljs-string">''</span>;

        <span class="hljs-keyword">if</span> (val == <span class="hljs-literal">undefined</span>) {
            <span class="hljs-keyword">if</span> (isString(name)) {
                <span class="hljs-keyword">var</span> el = <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>];

                <span class="hljs-keyword">return</span> el ? el.style[camelCase(name)] || getComputedStyle(el, name) : <span class="hljs-string">''</span>;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isObject(name)) {
                <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> name) {
                    ret += key + <span class="hljs-string">':'</span> + maybeAddPx(key, name[key]) + <span class="hljs-string">';'</span>;
                }
            }
        } <span class="hljs-keyword">else</span> {
            ret = name + <span class="hljs-string">':'</span> + maybeAddPx(name, val) + <span class="hljs-string">';'</span>;
        }

        <span class="hljs-keyword">return</span> each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            el.style.cssText += <span class="hljs-string">';'</span> + ret;
        });
    },

    show: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            el.style.display == <span class="hljs-string">'none'</span> &amp;&amp; (el.style.display = <span class="hljs-string">''</span>);
            <span class="hljs-keyword">if</span> (getComputedStyle(el, <span class="hljs-string">'display'</span>) == <span class="hljs-string">'none'</span>) {
                el.style.display = getDefaultDisplay(el.nodeName);
            }
        });
    },

    hide: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.css(<span class="hljs-string">'display'</span>, <span class="hljs-string">'none'</span>);
    },

    toggle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            <span class="hljs-keyword">var</span> $el = $(el);

            $el.css(<span class="hljs-string">'display'</span>) == <span class="hljs-string">'none'</span> ? $el.show() : $el.hide();
        });
    }

});

each([<span class="hljs-string">'width'</span>, <span class="hljs-string">'height'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(method)</span> {</span>
    node[method] = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(val)</span> {</span>
        <span class="hljs-keyword">var</span> el = <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>];

        <span class="hljs-keyword">if</span> (val) {
            <span class="hljs-keyword">return</span> $(<span class="hljs-keyword">this</span>).css(method, val);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> isWindow(el) ? el[camelCase(<span class="hljs-string">'inner-'</span> + method)] :
                isDocument(el) ? docEl[camelCase(<span class="hljs-string">'scroll-'</span> + method)] :
                    <span class="hljs-keyword">this</span>.offset()[method];
        }
    };
});

<span class="hljs-comment">/**
 * @ignore
 * @file node-traversal
 * @author 莫争 &lt;gaoli.gl@taobao.com&gt;
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filtered</span><span class="hljs-params">(els, selector)</span> {</span>
    <span class="hljs-keyword">var</span> $els = $(els);

    <span class="hljs-keyword">return</span> selector !== <span class="hljs-literal">undefined</span> ?
        $els.filter(
            isArray(selector) ?
                <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                    <span class="hljs-keyword">return</span> some.call(selector, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(filter)</span> {</span>
                        <span class="hljs-keyword">return</span> matches(el, filter);
                    });
                } :
                selector
        ) :
        $els;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">children</span><span class="hljs-params">(el)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">'children'</span> <span class="hljs-keyword">in</span> el ?
        slice.call(el.children) :
        map(el.childNodes, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            <span class="hljs-keyword">if</span> (isElement(el)) {
                <span class="hljs-keyword">return</span> el;
            }
        });
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nth</span><span class="hljs-params">(el, filter, property, includeSelf)</span> {</span>
    <span class="hljs-keyword">var</span> ret   = [],
        array = isArray(filter);

    el = includeSelf ? el : el[property];

    <span class="hljs-keyword">while</span> (el) {
        <span class="hljs-keyword">if</span> (el &amp;&amp; !isDocument(el) &amp;&amp; isElement(el) &amp;&amp; ret.indexOf(el) &lt; <span class="hljs-number">0</span>) {
            ret.push(el);
        }
        el = el[property];
    }

    <span class="hljs-keyword">if</span> (array &amp;&amp; !filter.length) {
        filter = <span class="hljs-literal">undefined</span>
    }

    ret = filtered(ret, filter);

    <span class="hljs-keyword">return</span> array ?
        ret :
        ret.item(<span class="hljs-number">0</span>);
}

mix(node, {

    item: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(index)</span> {</span>
        <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

        <span class="hljs-keyword">return</span> isNumber(index) ?
            index &gt;= self.length ?
                <span class="hljs-literal">null</span> :
                $(self[index]) :
            $(index);
    },

    first: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(filter)</span> {</span>
        <span class="hljs-keyword">return</span> nth(<span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>] &amp;&amp; <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>].firstChild, filter, <span class="hljs-string">'nextElementSibling'</span>, <span class="hljs-literal">true</span>);
    },

    last: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(filter)</span> {</span>
        <span class="hljs-keyword">return</span> nth(<span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>] &amp;&amp; <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>].lastChild, filter, <span class="hljs-string">'previousElementSibling'</span>, <span class="hljs-literal">true</span>);
    },

    next: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(filter)</span> {</span>
        <span class="hljs-keyword">return</span> nth(<span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>], filter, <span class="hljs-string">'nextElementSibling'</span>);
    },

    prev: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(filter)</span> {</span>
        <span class="hljs-keyword">return</span> nth(<span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>], filter, <span class="hljs-string">'previousElementSibling'</span>);
    },

    parent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(filter)</span> {</span>
        <span class="hljs-keyword">return</span> nth(<span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>], filter, <span class="hljs-string">'parentNode'</span>);
    },

    children: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selector)</span> {</span>
        <span class="hljs-keyword">var</span> el = <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>];

        <span class="hljs-keyword">return</span> el ?
            filtered(children(el), selector) :
            <span class="hljs-keyword">this</span>;
    },

    siblings: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selector)</span> {</span>
        <span class="hljs-keyword">var</span> el = <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>];

        <span class="hljs-keyword">return</span> el ?
            filtered(
                filter.call(children(el.parentNode), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(child)</span> {</span>
                    <span class="hljs-keyword">return</span> child !== el;
                })
            , selector) :
            <span class="hljs-keyword">this</span>;
    },

    contents: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> el = <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>];

        <span class="hljs-keyword">return</span> el ?
            $(slice.call(el.childNodes)) :
            <span class="hljs-keyword">this</span>;
    },

    contains: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(contained)</span> {</span>
        <span class="hljs-keyword">return</span> some.call(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            <span class="hljs-keyword">return</span> el !== contained &amp;&amp; el.contains(el);
        });
    }

});

<span class="hljs-comment">/**
 * @ignore
 * @file node-insertion
 * @author 莫争 &lt;gaoli.gl@taobao.com&gt;
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filterScripts</span><span class="hljs-params">(nodes, scripts)</span> {</span>
    <span class="hljs-keyword">var</span> ret = [];

    each(nodes, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(node)</span> {</span>
        <span class="hljs-keyword">var</span> name = node.nodeName,
            type = node.type,
            temp = [];

        <span class="hljs-keyword">if</span> (name &amp;&amp; name === <span class="hljs-string">'SCRIPT'</span> &amp;&amp; (!type || type === <span class="hljs-string">'text/javascript'</span>)) {
            node.parentNode &amp;&amp; node.parentNode.removeChild(node);
            scripts &amp;&amp; scripts.push(node);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (isElement(node)) {
                each(node.getElementsByTagName(<span class="hljs-string">'script'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                    temp.push(el);
                });
                filterScripts(temp, scripts);
            }
            ret.push(node);
        }
    });

    <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nodeListToFragment</span><span class="hljs-params">(nodes)</span> {</span>
    <span class="hljs-keyword">var</span> ret = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">if</span> (nodes &amp;&amp; likeArray(nodes)) {
        ret = doc.createDocumentFragment();

        each(nodes, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(node)</span> {</span>
            ret.appendChild(node);
        });
    }

    <span class="hljs-keyword">return</span> ret;
}

mix(node, {

    wrapAll: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(wrapperNode)</span> {</span>
        <span class="hljs-keyword">var</span> el = <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>];

        <span class="hljs-keyword">if</span> (el) {
            <span class="hljs-keyword">var</span> $wrapperNode = $(wrapperNode),
                $wrapperChildren;

            $wrapperNode.insertBefore(el);

            <span class="hljs-keyword">while</span> (($wrapperChildren = $wrapperNode.children()).length) {
                $wrapperNode = $wrapperNode.first();
            }

            $wrapperNode.append(<span class="hljs-keyword">this</span>);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    },

    wrap: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(wrapperNode)</span> {</span>
        <span class="hljs-keyword">var</span> $wrapperNode = $(wrapperNode),
            wrapperClone = $wrapperNode[<span class="hljs-number">0</span>].parentNode || <span class="hljs-keyword">this</span>.length;

        <span class="hljs-keyword">return</span> each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            $(el).wrapAll(
                wrapperClone ? $wrapperNode[<span class="hljs-number">0</span>].cloneNode(<span class="hljs-literal">true</span>) : $wrapperNode[<span class="hljs-number">0</span>]
            )
        });
    },

    unwrap: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            <span class="hljs-keyword">var</span> $el     = $(el),
                $parent = $el.parent();

            $parent.replaceWith($parent.children());
        });
    },

    wrapInner: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(wrapperNode)</span> {</span>
        <span class="hljs-keyword">return</span> each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            <span class="hljs-keyword">var</span> $el       = $(el),
                $children = $el.children();

            <span class="hljs-keyword">if</span> ($children.length) {
                $children.wrapAll(wrapperNode);
            } <span class="hljs-keyword">else</span> {
                $el.append(wrapperNode);
            }
        });
    },

    replaceWith: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(newNodes)</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.before(newNodes).remove();
    }

});

each([<span class="hljs-string">'after'</span>, <span class="hljs-string">'prepend'</span>, <span class="hljs-string">'before'</span>, <span class="hljs-string">'append'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(method, index)</span> {</span>
    <span class="hljs-keyword">var</span> inside = index % <span class="hljs-number">2</span>;

    node[method] = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(html, loadScripts)</span> {</span>
        <span class="hljs-keyword">var</span> nodes  = isString(html) ? node.create(html) : html,
            isCopy = <span class="hljs-keyword">this</span>.length &gt; <span class="hljs-number">1</span>,
            parent,
            target;

        <span class="hljs-keyword">if</span> (loadScripts) {
            <span class="hljs-keyword">var</span> scripts = [];
        }

        <span class="hljs-keyword">if</span> (nodes.length) {
            nodes = nodeListToFragment(filterScripts(nodes, scripts));
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

        <span class="hljs-keyword">return</span> each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            parent = inside ? el : el.parentNode;

            <span class="hljs-keyword">switch</span> (index) {
                <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:
                    target = el.nextSibling;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
                    target = el.firstChild;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
                    target = el;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">default</span>:
                    target = <span class="hljs-literal">null</span>
            }

            parent.insertBefore(isCopy ? nodes.cloneNode(<span class="hljs-literal">true</span>) : nodes, target);

            each(scripts, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                <span class="hljs-keyword">if</span> (el.src) {
                    getScript(el.src);
                } <span class="hljs-keyword">else</span> {
                    win[<span class="hljs-string">'eval'</span>].call(win, el.innerHTML);
                }
            });
        });
    };

    node[inside ? method + <span class="hljs-string">'To'</span> : <span class="hljs-string">'insert'</span> + (index ? <span class="hljs-string">'Before'</span> : <span class="hljs-string">'After'</span>)] = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(html)</span> {</span>
        $(html)[method](<span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };
});

<span class="hljs-comment">/**
 * @ignore
 * @file node-offset
 * @author 莫争 &lt;gaoli.gl@taobao.com&gt;
 */</span>

mix(node, {

    offset: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> ret = <span class="hljs-literal">null</span>,
            obj;

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.length) {
            obj = <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>].getBoundingClientRect();
            ret = {
                left  : obj.left + win.pageXOffset,
                top   : obj.top + win.pageYOffset,
                width : <span class="hljs-built_in">Math</span>.round(obj.width),
                height: <span class="hljs-built_in">Math</span>.round(obj.height)
            }
        }

        <span class="hljs-keyword">return</span> ret;
    }

});

each([<span class="hljs-string">'scrollTop'</span>, <span class="hljs-string">'scrollLeft'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(method, index)</span> {</span>

    node[method] = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(val)</span> {</span>
        <span class="hljs-keyword">var</span> el        = <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>],
            hasScroll = method <span class="hljs-keyword">in</span> el;

        <span class="hljs-keyword">return</span> val === <span class="hljs-literal">undefined</span> ?
            hasScroll ?
                el[method] :
                el[<span class="hljs-string">'page'</span> + (index ? <span class="hljs-string">'X'</span> : <span class="hljs-string">'Y'</span>) + <span class="hljs-string">'Offset'</span>]
            :
            hasScroll ?
                each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                    el[method] = val;
                }) :
                each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                    <span class="hljs-keyword">if</span> (index) {
                        el.scrollTo(val, el.scrollY);
                    } <span class="hljs-keyword">else</span> {
                        el.scrollTo(el.scrollX, val);
                    }
                });
    }

});

<span class="hljs-comment">/**
 * @ignore
 * @file node-create
 * @author 莫争 &lt;gaoli.gl@taobao.com&gt;
 */</span>

<span class="hljs-keyword">var</span> RE_TAG        = <span class="hljs-regexp">/&lt;([\w:]+)/</span>,
    RE_XHTML_TAG  = <span class="hljs-regexp">/&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^&gt;]*)\/&gt;/ig</span>,
    RE_SINGLE_TAG = <span class="hljs-regexp">/^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;)?$/</span>;

<span class="hljs-keyword">var</span> div        = doc.createElement(<span class="hljs-string">'div'</span>),
    table      = doc.createElement(<span class="hljs-string">'table'</span>),
    tableBody  = doc.createElement(<span class="hljs-string">'tbody'</span>),
    tableRow   = doc.createElement(<span class="hljs-string">'tr'</span>),
    containers = {
        <span class="hljs-string">'*'</span>  : div,
        thead: table,
        tbody: table,
        tfoot: table,
        tr   : tableBody,
        th   : tableRow,
        td   : tableRow
    };

mix(node, {

    create: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(html, props)</span> {</span>
        <span class="hljs-keyword">var</span> key,
            ret = [],
            tag,
            container;

        <span class="hljs-keyword">if</span> (!html || !isString(html)) {
            <span class="hljs-keyword">return</span> ret;
        }

        <span class="hljs-keyword">if</span> (RE_SINGLE_TAG.test(html)) {
            ret = $(doc.createElement(<span class="hljs-built_in">RegExp</span>.$<span class="hljs-number">1</span>));
        } <span class="hljs-keyword">else</span> {
            html = html.replace(RE_XHTML_TAG, <span class="hljs-string">'&lt;$1&gt;&lt;/$2&gt;'</span>);
            tag  = RE_TAG.test(html) &amp;&amp; <span class="hljs-built_in">RegExp</span>.$<span class="hljs-number">1</span>;

            container = containers[tag] || containers[<span class="hljs-string">'*'</span>];
            container.innerHTML = html;

            ret = each(slice.call(container.childNodes), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                container.removeChild(el);
            });
        }

        <span class="hljs-keyword">if</span> (isPlainObject(props)) {
            <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> props) {
                ret.attr(key, props[key]);
            }
        }

        <span class="hljs-keyword">return</span> ret;
    },

    html: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(html, loadScripts)</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>.length ?
            each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
                $(el).empty().append(html, loadScripts);
            }) :
            <span class="hljs-keyword">this</span>.length ? <span class="hljs-keyword">this</span>[<span class="hljs-number">0</span>].textContent : <span class="hljs-literal">null</span>;
    },

    remove: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            el.parentNode &amp;&amp; el.parentNode.removeChild(el)
        });
    },

    empty: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> each(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            el.innerHTML = <span class="hljs-string">''</span>;
        });
    },

    clone: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span> {</span>
            <span class="hljs-keyword">return</span> el.cloneNode(<span class="hljs-literal">true</span>);
        });
    }

});

<span class="hljs-comment">/**
 * @ignore
 * @file output
 * @author 莫争 &lt;gaoli.gl@taobao.com&gt;
 */</span>

mix(S, {
    node    : node,
    Node    : $,
    NodeList: $,
    one     : $.one,
    all     : $.all
});

S.add &amp;&amp; S.add(<span class="hljs-string">'node'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(S)</span> {</span>
    <span class="hljs-keyword">return</span> $;
});

}(<span class="hljs-keyword">this</span>, KISSY));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
